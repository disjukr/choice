{
    "comment": "The parser for Choi's programming language",
    "author": "JongChan Choi",
    "lex": {
        "macros": {
            "octal": "0[0-9]+",
            "hexadecimal": "0[Xx][0-9A-Fa-f]+",
            "decimal": "\\d*\\.?\\d+(?:[Ee](?:[+-]?\\d+)?)?"
        },
        "rules": [
            ["{octal}|{hexadecimal}|{decimal}", "return 'NUMBER'"],
            ["\"(?:[^\\\\\"]|\\\\.)*\"|'(?:[^\\\\']|\\\\.)*'", "return 'STRING'"],
            ["true|false", "return 'BOOLEAN'"],
            ["var\\b", "return 'VAR'"],
            ["val\\b", "return 'VAL'"],
            ["if\\b", "return 'IF'"],
            ["else\\b", "return 'ELSE'"],
            ["loop\\b", "return 'LOOP'"],
            ["while\\b", "return 'WHILE'"],
            ["for\\b", "return 'FOR'"],
            ["null", "return 'NULL'"],
            ["undefined", "return 'UNDEFINED'"],
            ["returns?|->", "return 'RETURN'"],
            ["[$_A-Za-z][$_0-9A-Za-z]*", "return 'IDENTIFIER'"],
            ["\\s+", ""],
            ["(?:\\/\\/|#).*(?=\\r\\n|\\n|$)", ""],
            ["\\/\\*([^*]|[\\r\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+\\/", ""],
            ["===", "return '==='"],
            ["==", "return '=='"],
            ["=", "return '='"],
            ["!==", "return '!=='"],
            ["!=", "return '!='"],
            ["!", "return '!'"],
            [">>>", "return '>>>'"],
            [">>", "return '>>'"],
            [">=", "return '>='"],
            [">", "return '>'"],
            ["<<", "return '<<'"],
            ["<=", "return '<='"],
            ["<", "return '<'"],
            ["\\{", "return '{'"],
            ["\\}", "return '}'"],
            ["\\[", "return '['"],
            ["\\]", "return ']'"],
            ["\\(", "return '('"],
            ["\\)", "return ')'"],
            ["\\?", "return '?'"],
            [":", "return ':'"],
            [";", "return ';'"],
            ["\\,", "return ','"],
            ["\\.", "return '.'"]
        ]
    },
    "start": "ast",
    "bnf": {
        "ast": [["statements", "return $1"]],
        "statement": [
            ["var_statement", "$$ = $1"],
            ["val_statement", "$$ = $1"],
            ["if_statement", "$$ = $1"],
            ["else_statement", "$$ = $1"],
            ["loop_statement", "$$ = $1"],
            ["while_statement", "$$ = $1"],
            ["for_statement", "$$ = $1"],
            ["expression ;", "$$ = $1"],
            [";", "$$ = $1"]
        ],
        "statements": [
            ["statement", "$$ = [$1]"],
            ["statements statement", "$1.push($2); $$ = $1"]
        ],
        "block_statements": [
            ["{ statements }", "$$ = $2"]
        ],
        "primary_expression": [
            ["IDENTIFIER", "$$ = $1"],
            ["value", "$$ = $1"],
            ["( expression )", "$$ = $2"]
        ],
        "postfix_expression": [
            ["primary_expression", "$$ = $1"],
            [
                "postfix_expression [ expression ]",
                "$$ = {type: 'access', expression: $1, field: $3}"
            ],
            [
                "postfix_expression . IDENTIFIER",
                "$$ = {type: 'access', expression: $1, field: $3}"
            ]
        ],
        "expression": [
            ["postfix_expression", "$$ = $1"],
            [
                "expression , postfix_expression",
                "$$ = {type: ',', left: $1, right: $3}"
            ]
        ],
        "key_value_pair": [
            [
                "IDENTIFIER : postfix_expression",
                "$$ = {type: 'member', key: $1, value: $3}"
            ],
            [
                "STRING : postfix_expression",
                "$$ = {type: 'member', key: $1, value: $3}"
            ]
        ],
        "members": [
            ["key_value_pair", "$$ = [$1]"],
            [
                "members , key_value_pair",
                "$1.push($3); $$ = $1"
            ]
        ],
        "arguments": [
            ["postfix_expression", "$$ = [$1]"],
            [
                "arguments , postfix_expression",
                "$1.push($3); $$ = $1"
            ]
        ],
        "parameters": [
            ["IDENTIFIER", "$$ = [$1]"],
            [
                "parameters , IDENTIFIER",
                "$1.push($3); $$ = $1"
            ]
        ],
        "value": [
            ["BOOLEAN", "$$ = $1"],
            ["NUMBER", "$$ = $1"],
            ["STRING", "$$ = $1"],
            ["object_literal", "$$ = $1"],
            ["array_literal", "$$ = $1"],
            ["lambda_literal", "$$ = $1"]
        ],
        "object_literal": [
            ["{ }", "$$ = {type: 'object', members: []}"],
            ["{ members }", "$$ = {type: 'object', members: $2}"]
        ],
        "array_literal": [
            ["[ ]", "$$ = {type: 'array', contents: []}"],
            ["[ arguments ]", "$$ = {type: 'array', contents: $2}"]
        ],
        "lambda_literal": [
            [
                "( ) RETURN postfix_expression",
                "$$ = {type: 'lambda', parameters: [], expression: $4}"
            ],
            [
                "( parameters ) RETURN postfix_expression",
                "$$ = {type: 'lambda', parameters: $2, expression: $5}"
            ],
            [
                "( parameters ) block_statements",
                "$$ = {type: 'block_lambda', parameters: $2, statements: $4}"
            ],
            [
                "( ) block_statements",
                "$$ = {type: 'block_lambda', parameters: [], statements: $3}"
            ]
        ],
        "var_statement": [
            [
                "VAR IDENTIFIER ;",
                "$$ = {type: 'var', name: $2, value: undefined}"
            ],
            [
                "VAR IDENTIFIER = expression ;",
                "$$ = {type: 'var', name: $2, value: $4}"
            ]
        ],
        "val_statement": [
            [
                "VAL IDENTIFIER ;",
                "$$ = {type: 'val', name: $2, value: undefined}"
            ],
            [
                "VAL IDENTIFIER = expression ;",
                "$$ = {type: 'val', name: $2, value: $4}"
            ]
        ],
        "if_statement": [
            [
                "IF expression block_statements",
                "$$ = {type: 'if', condition: $2, statements: $3}"
            ],
            [
                "IF ( expression ) statement",
                "$$ = {type: 'if', condition: $3, statements: [$5]}"
            ],
            [
                "IF ( expression ) block_statements",
                "$$ = {type: 'if', condition: $3, statements: $5}"
            ]
        ],
        "else_statement": [
            ["ELSE block_statements", "$$ = {type: 'else', statements: $2}"],
            ["ELSE statement", "$$ = {type: 'else', statements: [$2]}"]
        ],
        "loop_statement": [
            [
                "LOOP block_statements",
                "$$ = {type: 'loop', statements: $2}"
            ],
            [
                "LOOP statement",
                "$$ = {type: 'loop', statements: [$2]}"
            ]
        ],
        "while_statement": [
            [
                "WHILE expression block_statements",
                "$$ = {type: 'while', condition: $2, statements: $3}"
            ],
            [
                "WHILE ( expression ) statement",
                "$$ = {type: 'while', condition: $3, statements: [$5]}"
            ]
        ],
        "for_statement": [
            [
                "FOR ( expression ; expression ; expression ) statement",
                "$$ = {type: 'for', init: $3, cond: $5, loop: $7, statements: [$9]}"
            ],
            [
                "FOR ( var_statement expression ; expression ) statement",
                "$$ = {type: 'for', init: $3, cond: $4, loop: $6, statements: [$8]}"
            ]
        ]
    }
}
